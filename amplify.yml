version: 1
applications:
    - appRoot: packages/frontend
      frontend:
          phases:
              preBuild:
                  commands:
                      - yarn workspaces focus
              build:
                  commands:
                      - (curl -Ls https://cli.doppler.com/install.sh || wget -qO- https://cli.doppler.com/install.sh) | sh
                      - doppler run -- yarn workspaces foreach --parallel --interlaced --topological --recursive --verbose run build
          artifacts:
              baseDirectory: build
              files:
                  - '**/*'
          cache:
              paths:
                  - node_modules/**/*
    - appRoot: packages/client
      frontend:
          phases:
              preBuild:
                  commands:
                      - yarn workspaces focus
              build:
                  commands:
                      - yarn workspaces foreach build
          artifacts:
              baseDirectory: dist
              files:
                  - '**/*'
          cache:
              paths:
                  - node_modules/**/*
